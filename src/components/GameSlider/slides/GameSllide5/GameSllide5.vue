<!-- eslint-disable vue/no-parsing-error -->
<template>
  <img :src="bg7" alt="slide" />
  <svg
    :class="{ 'no-continue-button': !isContinueBtn }"
    width="1934"
    viewBox="0 0 1934 1080"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g>
      <g id="interactive">
        <path
          id="Vector 1"
          d="M700.5 429.5L14 382.5V835.5L695.5 831.5L700.5 429.5Z"
          fill="black"
          fill-opacity="0.01"
          stroke="black"
          stroke-opacity="0.01"
        />
        <g id="Group 524">
          <g id="Ellipse 1" filter="url(#filter0_f_260_2759)">
            <ellipse
              cx="351.605"
              cy="649.251"
              rx="301.351"
              ry="47.5"
              transform="rotate(1.6679 351.605 649.251)"
              fill="white"
              fill-opacity="0.76"
            />
          </g>
          <g id="Ellipse 2" filter="url(#filter1_f_260_2759)">
            <ellipse
              cx="264.776"
              cy="592.878"
              rx="185.473"
              ry="47.5"
              transform="rotate(1.6679 264.776 592.878)"
              fill="white"
              fill-opacity="0.76"
            />
          </g>
        </g>
      </g>
      <g id="further-btn">
        <rect x="631" y="918" width="685" height="72" rx="20" fill="white" />
        <text
          fill="#010101"
          xml:space="preserve"
          style="white-space: pre"
          font-family="Gogh"
          font-size="22"
          font-weight="500"
          letter-spacing="0em"
        >
          <tspan x="868.971" y="961.477">
            &#x41f;&#x440;&#x43e;&#x434;&#x43e;&#x43b;&#x436;&#x438;&#x442;&#x44c;
          </tspan>
        </text>
        <g id="Group 528">
          <rect
            id="Rectangle 197"
            x="1028.97"
            y="953"
            width="42"
            height="2"
            fill="#010101"
          />
          <path
            id="Polygon 2"
            d="M1078.03 954L1063.78 960.928L1068.47 954L1063.78 947.072L1078.03 954Z"
            fill="#010101"
          />
        </g>
      </g>
      <g id="text-0">
        <g id="Frame 102">
          <path
            d="M301 462C301 453.163 308.163 446 317 446H1082V573C1082 581.837 1074.84 589 1066 589H317C308.163 589 301 581.837 301 573V462Z"
            fill="white"
          />
          <text
            id="value"
            fill="black"
            xml:space="preserve"
            style="white-space: pre"
            font-family="Gogh"
            font-size="22"
            font-weight="500"
            letter-spacing="0em"
          >
            <tspan x="346" y="500.477">
              &#x41c;&#x44b;
              &#x440;&#x430;&#x441;&#x441;&#x43a;&#x430;&#x437;&#x430;&#x43b;&#x438;
              &#x442;&#x435;&#x431;&#x435; &#x43e;
              &#x43d;&#x430;&#x448;&#x435;&#x439;
              &#x43a;&#x43e;&#x43c;&#x43f;&#x430;&#x43d;&#x438;&#x438;, &#x430;
              &#x442;&#x435;&#x43f;&#x435;&#x440;&#x44c; &#x442;&#x44b;
              &#x440;&#x430;&#x441;&#x441;&#x43a;&#x430;&#x436;&#x438;
            </tspan>
            <tspan x="346" y="534.477">
              &#x43e; &#x441;&#x435;&#x431;&#x435;. &#x423;
              &#x442;&#x435;&#x431;&#x44f; &#x435;&#x441;&#x442;&#x44c;
              &#x43e;&#x43f;&#x44b;&#x442; &#x432;
              &#x43f;&#x440;&#x43e;&#x433;&#x440;&#x430;&#x43c;&#x43c;&#x438;&#x440;&#x43e;&#x432;&#x430;&#x43d;&#x438;&#x438;?
            </tspan>
          </text>
        </g>
        <path
          id="Vector 17"
          d="M1081 446H1101L1082.71 464.293L1081 466V463.586V446Z"
          fill="white"
        />
      </g>
      <g id="text-1">
        <g id="Frame 102_2">
          <path
            d="M248 258C248 249.163 255.163 242 264 242H1013C1021.84 242 1029 249.163 1029 258V385H264C255.163 385 248 377.837 248 369V258Z"
            fill="white"
          />
          <text
            id="value_2"
            fill="black"
            xml:space="preserve"
            style="white-space: pre"
            font-family="Gogh"
            font-size="22"
            font-weight="500"
            letter-spacing="0em"
          >
            <tspan x="293" y="296.477">
              &#x422;&#x44b; &#x442;&#x43e;&#x447;&#x43d;&#x43e; &#x43f;&#x43e;
              &#x430;&#x434;&#x440;&#x435;&#x441;&#x443;. 1&#x421; &#x2013;
              &#x44d;&#x442;&#x43e;
              &#x43e;&#x442;&#x43b;&#x438;&#x447;&#x43d;&#x430;&#x44f;
              &#x43f;&#x43b;&#x43e;&#x449;&#x430;&#x434;&#x43a;&#x430;
              &#x434;&#x43b;&#x44f;
            </tspan>
            <tspan x="293" y="330.477">
              &#x43a;&#x43e;&#x43c;&#x444;&#x43e;&#x440;&#x442;&#x43d;&#x43e;&#x433;&#x43e;
              &#x441;&#x442;&#x430;&#x440;&#x442;&#x430; &#x432; IT.
              &#x421;&#x435;&#x439;&#x447;&#x430;&#x441; &#x44f;
              &#x432;&#x441;&#x435;
              &#x440;&#x430;&#x441;&#x441;&#x43a;&#x430;&#x436;&#x443; &#x438;
              &#x43f;&#x43e;&#x43a;&#x430;&#x436;&#x443;.
            </tspan>
          </text>
        </g>
        <path
          id="Vector 17_2"
          d="M1028 385V365L1046.29 383.293L1048 385H1045.59H1028Z"
          fill="white"
        />
      </g>
    </g>
    <defs>
      <filter
        id="filter0_f_260_2759"
        x="0.37793"
        y="550.959"
        width="702.454"
        height="196.584"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="25"
          result="effect1_foregroundBlur_260_2759"
        />
      </filter>
      <filter
        id="filter1_f_260_2759"
        x="29.377"
        y="495.088"
        width="470.798"
        height="195.58"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="25"
          result="effect1_foregroundBlur_260_2759"
        />
      </filter>
    </defs>
  </svg>
  <audio ref="audio" :src="audioVitaly1"></audio>
</template>

<script setup>
import { nextTick, onBeforeUnmount, onMounted, ref, watch } from "vue";
// import { useUserStore } from '@/store/user'
import { useNavigationStore } from "@/store/navigation";
// import { storeToRefs } from 'pinia'
import bg7 from "@/assets/slides-images/seven/bg.webp";
import useFurtherButton from "../../composables/useFurtherButton";
import vitaly from "./assets/vitaly.mp3";
import vitaly2 from "./assets/vitaly2.mp3";

const navigation = useNavigationStore();
const replicStep = ref(0);
const replicStepAskWaiting = ref(true);
useFurtherButton();
// eslint-disable-next-line no-undef
const emit = defineEmits(["question"]);
const isContinueBtn = ref(false);

let text1;
let text2;
let interactive;
const audioVitaly1 = new Audio(vitaly);
const audioVitaly2 = new Audio(vitaly2);

watch(replicStep, (value) => {
  switch (value) {
    case 1:
      audioVitaly1.pause();
      text2.classList.add("visible");

      setTimeout(() => {
        audioVitaly2.play();
        interactive.classList.add("active");
        interactive.addEventListener("click", () => {
          audioVitaly2.pause();
          navigation.stepForward();
        });
      }, 1000);

      break;

    default:
      break;
  }
});

const nextStep = () => {
  replicStepAskWaiting.value = false;
  text1.classList.remove("visible");
  replicStep.value++;
};

// eslint-disable-next-line no-undef
defineExpose({
  nextStep,
});

// const user = useUserStore()
// const { userName } = storeToRefs(user)

onMounted(async () => {
  await nextTick();

  document.addEventListener("nextReplic", () => {
    if (!replicStepAskWaiting.value) {
      replicStep.value += 1;
    }
  });

  text1 = document.querySelector("#text-0");
  text2 = document.querySelector("#text-1");
  interactive = document.querySelector("#interactive");

  setTimeout(() => {
    text1.classList.add("visible");
    audioVitaly1.play();
  }, 1500);

  setTimeout(() => {
    emit("question");
  }, 2500);
});
</script>

<style scoped lang="scss">
#interactive {
  display: none;

  &.active {
    display: block;
  }
}

.no-continue-button #further-btn {
  display: none;
}
</style>
