<!-- eslint-disable vue/no-parsing-error -->
<template>
  <img :src="bg19" alt="slide" />

  <svg
    width="1920"
    height="1080"
    viewBox="0 0 1920 1080"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g>
      <g id="text-1">
        <path
          id="Vector 17"
          d="M1011 337V357L992.707 338.707L991 337H993.414H1011Z"
          fill="white"
        />
        <g id="Frame 102">
          <path
            d="M1010 337H1775C1783.84 337 1791 344.163 1791 353V454C1791 462.837 1783.84 470 1775 470H1026C1017.16 470 1010 462.837 1010 454V337Z"
            fill="white"
          />
          <text
            id="value"
            fill="black"
            xml:space="preserve"
            style="white-space: pre"
            font-family="Gogh"
            font-size="22"
            font-weight="500"
            letter-spacing="0em"
          >
            <tspan x="1055" y="388.977">
              {{ userName }}, &#x43f;&#x440;&#x438;&#x432;&#x435;&#x442;!
              &#x41c;&#x44b; &#x441; &#x442;&#x43e;&#x431;&#x43e;&#x439;
              &#x443;&#x436;&#x435;
              &#x432;&#x438;&#x434;&#x435;&#x43b;&#x438;&#x441;&#x44c;,
              &#x43c;&#x435;&#x43d;&#x44f; &#x437;&#x43e;&#x432;&#x443;&#x442;
            </tspan>
            <tspan x="1055" y="417.977">
              &#x418;&#x440;&#x438;&#x43d;&#x430;,
              &#x44f;&#xa0;&#x433;&#x43b;&#x430;&#x432;&#x43d;&#x44b;&#x439;
              &#x431;&#x443;&#x445;&#x433;&#x430;&#x43b;&#x442;&#x435;&#x440;
              &#x43a;&#x43e;&#x43c;&#x43f;&#x430;&#x43d;&#x438;&#x438;
              &laquo;IT-&#x421;&#x435;&#x440;&#x432;&#x438;&#x441;&raquo;.
            </tspan>
          </text>
        </g>
      </g>
      <g id="text-2">
        <path
          id="Vector 17_2"
          d="M1011 315H991L1009.29 296.707L1011 295V297.414V315Z"
          fill="white"
        />
        <g id="Frame 102_2">
          <path
            d="M1010 198C1010 189.163 1017.16 182 1026 182H1775C1783.84 182 1791 189.163 1791 198V299C1791 307.837 1783.84 315 1775 315H1010V198Z"
            fill="white"
          />
          <text
            id="value_2"
            fill="black"
            xml:space="preserve"
            style="white-space: pre"
            font-family="Gogh"
            font-size="22"
            font-weight="500"
            letter-spacing="0em"
          >
            <tspan x="1055" y="233.977">
              &#x412;&#x438;&#x442;&#x430;&#x43b;&#x438;&#x439;
              &#x443;&#x436;&#x435; &#x441;&#x43a;&#x430;&#x437;&#x430;&#x43b;
              &#x442;&#x435;&#x431;&#x435;, &#x447;&#x442;&#x43e; &#x442;&#x44b;
              &#x43c;&#x43e;&#x436;&#x435;&#x448;&#x44c;
              &#x437;&#x430;&#x431;&#x440;&#x430;&#x442;&#x44c;
              &#x43f;&#x43e;&#x43b;&#x443;&#x447;&#x435;&#x43d;&#x43d;&#x44b;&#x435;
            </tspan>
            <tspan x="1055" y="262.977">
              &#x434;&#x435;&#x43d;&#x44c;&#x433;&#x438; &#x43a;&#x430;&#x43a;
              &#x43f;&#x440;&#x438;&#x431;&#x430;&#x432;&#x43a;&#x443; &#x43a;
              &#x441;&#x432;&#x43e;&#x435;&#x439;
              &#x43f;&#x435;&#x440;&#x432;&#x43e;&#x439;
              &#x437;&#x430;&#x440;&#x43f;&#x43b;&#x430;&#x442;&#x435;.
            </tspan>
          </text>
        </g>
      </g>
      <g id="text-3">
        <path
          id="Vector 17_3"
          d="M1011 336V356L992.707 337.707L991 336H993.414H1011Z"
          fill="white"
        />
        <g id="Frame 102_3">
          <path
            d="M1010 336H1775C1783.84 336 1791 343.163 1791 352V482C1791 490.837 1783.84 498 1775 498H1026C1017.16 498 1010 490.837 1010 482V336Z"
            fill="white"
          />
          <text
            id="value_3"
            fill="black"
            xml:space="preserve"
            style="white-space: pre"
            font-family="Gogh"
            font-size="22"
            font-weight="500"
            letter-spacing="0em"
          >
            <tspan x="1055" y="387.977">
              &#x41d;&#x43e; &#x447;&#x442;&#x43e;&#x431;&#x44b;
              &#x442;&#x435;&#x431;&#x44f;
              &#x442;&#x440;&#x443;&#x434;&#x43e;&#x443;&#x441;&#x442;&#x440;&#x43e;&#x438;&#x442;&#x44c;
              &#x43a; &#x43d;&#x430;&#x43c; &#x432; &#x448;&#x442;&#x430;&#x442;
              &#x438;&#x43b;&#x438; &#x432; &#x448;&#x442;&#x430;&#x442;
            </tspan>
            <tspan x="1055" y="416.977">
              &#x43a;&#x43e;&#x43c;&#x43f;&#x430;&#x43d;&#x438;&#x438;-&#x43f;&#x430;&#x440;&#x442;&#x43d;&#x435;&#x440;&#x430;,
              &#x443; &#x442;&#x435;&#x431;&#x44f;
              &#x434;&#x43e;&#x43b;&#x436;&#x435;&#x43d;
              &#x431;&#x44b;&#x442;&#x44c;
              &#x431;&#x43e;&#x43b;&#x44c;&#x448;&#x43e;&#x439;
              &#x43d;&#x430;&#x431;&#x43e;&#x440;
            </tspan>
            <tspan x="1055" y="445.977">
              &#x437;&#x43d;&#x430;&#x43d;&#x438;&#x439; &#x438;
              &#x43d;&#x430;&#x432;&#x44b;&#x43a;&#x43e;&#x432;.
            </tspan>
          </text>
        </g>
      </g>
      <g id="further-btn">
        <rect x="617" y="920" width="685" height="70" rx="20" fill="white" />
        <text
          fill="#010101"
          xml:space="preserve"
          style="white-space: pre"
          font-family="Gogh"
          font-size="22"
          font-weight="500"
          letter-spacing="0em"
        >
          <tspan x="854.969" y="962.477">
            &#x41f;&#x440;&#x43e;&#x434;&#x43e;&#x43b;&#x436;&#x438;&#x442;&#x44c;
          </tspan>
        </text>
        <g id="Group 528">
          <rect
            id="Rectangle 197"
            x="1014.97"
            y="954"
            width="42"
            height="2"
            fill="#010101"
          />
          <path
            id="Polygon 2"
            d="M1064.03 955L1049.78 961.928L1054.47 955L1049.78 948.072L1064.03 955Z"
            fill="#010101"
          />
        </g>
      </g>
    </g>
  </svg>
</template>

<script setup>
import { nextTick, onMounted, ref, watch } from "vue";
import { useUserStore } from "@/store/user";
import { storeToRefs } from "pinia";
import useFurtherButton from "../../composables/useFurtherButton";
import bg19 from "@/assets/slides-images/nineteen/bg.webp";
import irina from "./assets/irina.mp3";
import irina2 from "./assets/irina2.mp3";
import irina3 from "./assets/irina3.mp3";

// eslint-disable-next-line no-undef
const emit = defineEmits(["nextSlide", "question"]);

const user = useUserStore();
const { userName } = storeToRefs(user);
const replicStepAskWaiting = ref(false);
const audioIrina = new Audio(irina);
const audioIrina2 = new Audio(irina2);
const audioIrina3 = new Audio(irina3);

useFurtherButton();
const nextStep = () => {
  replicStepAskWaiting.value = false;
  replicStep.value += 1;
};

let text1, text2, text3;

const replicStep = ref(0);

watch(replicStep, (value) => {
  switch (value) {
    case 1:
      audioIrina.pause();
      text1.classList.remove("visible");
      audioIrina2.play();
      text2.classList.add("visible");
      break;

    case 2:
      audioIrina2.pause();
      audioIrina3.play();

      text3.classList.add("visible");
      break;

    case 3:
      audioIrina3.pause();
      emit("nextSlide");
      break;

    default:
      break;
  }
});

onMounted(async () => {
  await nextTick();

  document.addEventListener("nextReplic", () => {
    if (replicStepAskWaiting.value === true) return;
    replicStep.value += 1;
  });

  text1 = document.querySelector("#text-1");
  text2 = document.querySelector("#text-2");
  text3 = document.querySelector("#text-3");

  replicStepAskWaiting.value = true;
  setTimeout(() => {
    audioIrina.play();
    text1.classList.add("visible");
  }, 500);

  setTimeout(() => {
    emit("question");
  }, 1500);
});

// eslint-disable-next-line no-undef
defineExpose({
  nextStep,
});
</script>

<style lang="scss"></style>
